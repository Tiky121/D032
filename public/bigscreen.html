<!DOCTYPE html>
<html lang="sk">
<head>
    <title>Big Screen PRO</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; background: rgb(255, 255, 255); overflow: hidden; font-family: sans-serif; color: rgb(0, 0, 0); }
        .wrapper { position: relative; width: 100vw; height: 100vh; }
        
        /* Placeholder pre Big Screen */
        #placeholder {
            position: absolute; inset: 0; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle, #222 0%, #000 100%);
            z-index: 10;
        }
        video { width: 100%; height: 100%; object-fit: contain; position: relative; z-index: 20; display: none; }
    </style>
</head>
<body>
    <div id="start-overlay">
        <button class="btn-primary" onclick="startBS()">SPUSTIŤ PREZENTÁCIU</button>
    </div>

    <div class="wrapper">
        <div id="placeholder">
            <img src="logo.svg" alt="UMIKT" class="logo-img" style="opacity: 0.8;">
            <div id="waiting-text">Pripravené na zdieľanie obrazovky</div>
        </div>
        <video id="screenVideo" autoplay playsinline style="display:none;"></video>
    </div>

    <script>
        const socket = io('/');
        const peerConfig = {
            host: '0.peerjs.com', port: 443, secure: true,
            config: { iceTransportPolicy: 'all', 'iceServers': [{ urls: 'stun:stun.l.google.com:19302' }] }
        };

        function startBS() {
            document.getElementById('start-overlay').style.display = 'none';
            const peer = new Peer(peerConfig);
            
            peer.on('open', id => {
                console.log("ID: " + id);
                socket.emit('register-bigscreen', id);
            });

            peer.on('call', call => {
                call.answer();
                call.on('stream', s => {
                    // Prišiel stream -> Schovať placeholder, ukázať video
                    document.getElementById('placeholder').style.display = 'none';
                    const v = document.getElementById('screenVideo');
                    v.style.display = 'block';
                    v.srcObject = s;
                });
            });

            // Keď ktokoľvek klikne "Stop Sharing"
            socket.on('stopped-sharing', () => {
                const v = document.getElementById('screenVideo');
                v.srcObject = null; // Vyčistiť
                v.style.display = 'none'; // Skryť
                document.getElementById('placeholder').style.display = 'flex'; // Ukázať background
            });
        }
    </script>
</body>
</html>