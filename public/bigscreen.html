<!DOCTYPE html>
<html lang="sk">
<head>
    <title>Big Screen</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
</head>
<body>
    <div id="start-overlay" class="start-overlay">
        <button class="btn-primary" onclick="startBigScreen()">AKTIVOVA≈§ PREZENT√ÅCIU</button>
    </div>
    
    <div class="video-wrapper" style="background: #0f1014; flex-direction: column;">
        <div id="waiting-text" style="text-align:center; color: var(--text-secondary);">
            <div style="font-size: 4rem; margin-bottom: 20px;">üì∫</div>
            <h2>Pripraven√© na zdieƒæanie</h2>
        </div>
        <video id="screenVideo" autoplay playsinline style="display:none;"></video>
    </div>

    <script>
        const PREFIX = "tiky-final-v2-"; 
        const myPeerId = PREFIX + 'big-screen';
        
        const peerConfig = {
            host: '0.peerjs.com',
            port: 443,
            secure: true,
            config: {
                'iceServers': [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { 
                        urls: "turn:openrelay.metered.ca:80",
                        username: "openrelayproject",
                        credential: "openrelayproject"
                    },
                    { 
                        urls: "turn:openrelay.metered.ca:443",
                        username: "openrelayproject",
                        credential: "openrelayproject"
                    },
                    { 
                        urls: "turn:openrelay.metered.ca:443?transport=tcp",
                        username: "openrelayproject",
                        credential: "openrelayproject"
                    }
                ]
            }
        };

        function startBigScreen() {
            document.getElementById('start-overlay').style.display = 'none';
            const peer = new Peer(myPeerId, peerConfig);
            
            peer.on('open', (id) => console.log("BigScreen READY: " + id));
            
            peer.on('call', call => {
                call.answer(); 
                call.on('stream', stream => {
                    document.getElementById('screenVideo').srcObject = stream;
                    document.getElementById('screenVideo').style.display = 'block';
                    document.getElementById('waiting-text').style.display = 'none';
                    
                    stream.getVideoTracks()[0].onended = () => {
                        document.getElementById('screenVideo').style.display = 'none';
                        document.getElementById('waiting-text').style.display = 'block';
                    };
                });
            });
        }
    </script>
</body>
</html>